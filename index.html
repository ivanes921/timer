<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Секундомер</title>

  <!-- PWA + iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-180.png">
  <link rel="manifest" href="manifest.webmanifest">

  <style>
    @font-face{
      font-family: "SFProDisplayThin";
      src: url("./fonts/SF-Pro-Display-Thin.woff") format("woff");
      font-weight: 100;
      font-style: normal;
      font-display: swap;
    }

    /* вращение иконки "Мировые часы" при секретном режиме */
    .icon.rotate {
      transform: rotate(90deg);
      transition: transform 0.3s ease;
    }

    :root{
      --bg:#000;
      --fg:#fff;

      --btn-circle:#1c1c1e;
      --btn-circle-text:#98989f;
      --btn-circle-pressed:#101010;

      --btn-circle-active:#343434;
      --btn-circle-active-text:#ffffff;
      --btn-circle-active-pressed:#1b1b1b;

      --btn-reset:#343434;
      --btn-reset-text:#ffffff;
      --btn-reset-pressed:#101010;

      --btn-start:#092911;
      --btn-start-text:#4dc77c;
      --btn-start-pressed:#061609;

      --btn-stop:#340e0d;
      --btn-stop-text:#be5046;
      --btn-stop-pressed:#1b0706;
    }

    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    html,body{height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:"SFProDisplayThin", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;}

    .app{
      height:100%;
      display:flex;
      flex-direction:column;
      padding-top: max(24px, env(safe-area-inset-top));
      padding-bottom: calc(78px + env(safe-area-inset-bottom));
    }

    .top{
      display:flex;
      flex-direction:column;
      align-items:center;
      margin-top: 18vh;
      margin-bottom: 6px;
    }

    /* ВРЕМЯ */
    .time{
      font-weight:100;
      font-size: min(9vh, 76px);
      display:flex;
      justify-content:center;
      align-items:flex-end;
      margin: 0 auto 80px auto;
      letter-spacing: -1px;
      width: calc(100% - 60px);
      text-align:center;
      font-variant-numeric: tabular-nums;
      font-feature-settings: "tnum" 1;
    }
    .time span{
      display:inline-flex;
      justify-content:center;
      align-items:flex-end;
      width:1ch;
    }
    .time-val{
      font-variant-numeric: tabular-nums;
      font-feature-settings: "tnum" 1;
    }
    .comma{padding:0 2px; position:relative; top:-4px;}

    /* КНОПКИ */
    .controls{
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 0 30px;
      position: relative;
    }
    .btn{
      width:84px; height:84px;
      border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:18px;
      user-select:none;
    }

    .btn.circle{ background:var(--btn-circle); color:var(--btn-circle-text);}
    .btn.circle:active{ background:var(--btn-circle-pressed); }

    .btn.circle-active{ background:var(--btn-circle-active); color:var(--btn-circle-active-text);}
    .btn.circle-active:active{ background:var(--btn-circle-active-pressed); }

    .btn.reset{ background:var(--btn-reset); color:var(--btn-reset-text);}
    .btn.reset:active{ background:var(--btn-reset-pressed); }

    .btn.green{ background:var(--btn-start); color:var(--btn-start-text);}
    .btn.green:active{ background:var(--btn-start-pressed); }

    .btn.red{ background:var(--btn-stop); color:var(--btn-stop-text);}
    .btn.red:active{ background:var(--btn-stop-pressed); }

    .dots{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      display:flex; gap:10px; top:50%;
    }
    .dot{width:8px; height:8px; border-radius:50%; background:#d9d9d9;}
    .dot.dim{opacity:.45;}

    /* ЛАП-ТАБЛИЦА */
    .laps{
      margin: 6px 30px 0 30px;
      color:#e5e5ea;
      font-size:20px;
      max-height: 32vh;
      overflow:auto;
      scrollbar-width: none;
      border-top: 1px solid #1c1c1e;
      min-height: 44px;
    }
    .laps.empty::after{
      content:"";
      display:block;
      height:34px;
    }
    .lap-row{
      display:flex; justify-content:space-between; padding:10px 0;
      border-bottom:1px solid #1c1c1e;
    }

    /* ТАББАР */
    .tabbar{
      position:fixed; left:0; right:0; bottom:0;
      height:78px;
      padding-bottom: env(safe-area-inset-bottom);
      background:#000;
      display:flex; justify-content:space-between; align-items:center;
      font-size:12px;
      padding: 0 30px;
    }
    .tab{
      height:100%; display:flex; flex-direction:column;
      align-items:center; justify-content:center; gap:4px; user-select:none;
    }
    .tab .icon{width:24px; height:24px;}
  </style>
</head>
<body>
  <div class="app">
    <div class="top">
      <div class="time">
        <span id="mm">00</span><span class="comma">:</span><span id="ss">00</span><span class="comma">,</span><span id="cc">00</span>
      </div>

      <div class="controls">
        <div id="leftBtn" class="btn circle">Круг</div>
        <div class="dots"><div class="dot"></div><div class="dot dim"></div></div>
        <div id="rightBtn" class="btn green">Старт</div>
      </div>
    </div>

    <div id="laps" class="laps empty"></div>
  </div>

  <!-- ТАББАР -->
  <nav class="tabbar">
    <div id="tab-world" class="tab">
      <!-- Мировые часы -->
      <svg id="icon-world" class="icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path fill="#7c7c7c" d="M256,48c-0.1,0-0.1,0-0.2,0c0,0,0,0-0.1,0c-0.1,0-0.2,0-0.2,0C140.8,48.3,48,141.3,48,256c0,114.7,92.8,207.7,207.5,208
	c0.1,0,0.2,0,0.2,0c0,0,0,0,0.1,0c0.1,0,0.1,0,0.2,0c114.9,0,208-93.1,208-208C464,141.1,370.9,48,256,48z M264.3,172.5
	c22.1-0.6,43.5-3.5,64.2-8.5c6.2,24.5,10.1,52.8,10.7,83.8h-74.9V172.5z M264.3,155.8V66c22.4,6.2,45.2,36.1,59.6,82
	C304.7,152.6,284.8,155.2,264.3,155.8z M247.7,65.8v90.1c-20.7-0.6-40.8-3.3-60.1-8C202.2,101.7,225.1,71.6,247.7,65.8z
	 M247.7,172.5v75.2h-75.4c0.6-31,4.5-59.3,10.7-83.8C203.8,168.9,225.5,171.9,247.7,172.5z M155.5,247.7H64.9
	c1.8-42.8,17.8-82,43.3-113c18.5,10.2,38.2,18.6,58.8,24.8C160.2,186,156.2,215.9,155.5,247.7z M155.5,264.3
	c0.6,31.7,4.6,61.7,11.4,88.2c-20.6,6.3-40.2,14.6-58.8,24.8c-25.5-31-41.4-70.2-43.3-113H155.5z M172.3,264.3h75.4v75.1
	c-22.2,0.6-43.9,3.6-64.7,8.7C176.8,323.6,172.9,295.3,172.3,264.3z M247.7,356.1v90.2c-22.6-5.9-45.5-35.9-60.1-82.1
	C206.9,359.4,227,356.7,247.7,356.1z M264.3,446v-90c20.5,0.6,40.4,3.3,59.7,7.9C309.5,409.9,286.8,439.8,264.3,446z M264.3,339.4
	v-75.1h74.9c-0.6,30.9-4.5,59.2-10.7,83.7C307.8,343,286.4,340,264.3,339.4z M355.9,264.3h91.2c-1.8,42.8,17.8,81.9-43.3,113
	c-18.7-10.3-38.5-18.7-59.3-25C351.3,325.8,355.3,296,355.9,264.3z M355.9,247.7c-0.6-31.7-4.6-61.6-11.3-88.1
	c20.8-6.3,40.6-14.7,59.2-24.9c25.5,31,41.5,70.2,43.3,113.1H355.9z M392.4,121.9c-16.6,8.8-34,16.1-52.3,21.6
	c-9.7-31.3-23.4-56.8-39.5-73.6C336,78.4,367.6,96.8,392.4,121.9z M210.8,70.1c-16.1,16.7-29.7,42.2-39.3,73.3
	c-18.1-5.5-35.4-12.7-51.8-21.5C144.2,96.9,175.6,78.6,210.8,70.1z M119.6,390c16.4-8.8,33.8-16,51.8-21.5
	c9.7,31.2,23.3,56.6,39.4,73.4C175.6,433.4,144.2,415.1,119.6,390z M300.6,442.1c16.2-16.8,29.8-42.3,39.6-73.7
	c18.3,5.5,35.7,12.8,52.3,21.6C367.7,415.2,336,433.6,300.6,442.1z"/>
      </svg>
      <div class="label" style="color:#7c7c7c">Мировые часы</div>
    </div>

    <div class="tab">
      <!-- Будильники -->
      <svg class="icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path fill="#7c7c7c" d="M438.4,192.4c12.2-14.2,19.6-32.3,19.6-52.2c0.1-43.8-35.5-79.6-80.4-82.1c-1.6-0.1-3.1-0.1-4.8-0.1
		c-20.4-0.1-39.1,6.8-53.8,18.1l53.8,52.4l-10.6,10.4c-25.7-19.4-57.2-32-91.2-34.9v-0.1c0-8.5-7-15.5-15.5-15.5s-15.5,7-15.5,15.5
		v0.1c-34,2.9-65,15.5-90.6,34.9L139,128.6l53.8-52.4c-14.7-11.4-33.4-18.2-53.7-18.1c-1.6,0-3.2,0.1-4.8,0.1
		c-45,2.5-80.6,38.3-80.4,82.1c0,19.8,7.4,38,19.6,52.2l54-52.6l9.5,9.5c-35.1,31.9-57.1,78-57.1,129.2c0,43.9,16.2,84,43,114.7
		l-36.4,44.6L99,448l35.2-42.9c31.6,30.2,74.4,48.9,121.6,48.9h0.1c0,0,0.2,0,0.3,0c47.2,0,90.2-18.7,121.8-48.9l35.2,43l12.3-10.1
		L389,393.3c26.8-30.8,43-70.9,43-114.7c0-51.1-22-97.3-57.2-129.3l9.5-9.5L438.4,192.4z M272,304H160v-16h96V160h16V304z"/>
      </svg>
      <div class="label" style="color:#7c7c7c">Будильники</div>
    </div>

    <div class="tab">
      <!-- Секундомер -->
      <svg class="icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
       <path fill="#ff9f0a" d="M397.6,146.7l-1.8-1.7h18.4l8.5,7.8l22.5-22.8l-40.8-40.3L381.2,112l8.8,9.2v18.6l-5-4.7
    c-31.3-28.3-70-45.2-113-48.9V48h-32v38h-2c-43.7,3-85,22.5-116,53v-17.8l8.9-9.2L108,89.8L67.2,130l22.5,22.8l8.5-7.8H116
    c-0.3,0-0.7,0.7-1,1.1C82.2,181.2,64,227,64,274.6C64,379,150.1,464,256.1,464C361.9,464,448,379.1,448,274.7
    C448,227.1,430,181.6,397.6,146.7z M264,318.2l-8,17.8l-8-17.8c-14-3.5-24-15.8-24-30.5c0-13.8,11.5-26,24-30.3V128h16v129.3
    c13.5,3.7,24,15.9,24,30.4C288,302.4,278,314.7,264,318.2z"/>
      </svg>
      <div class="label" style="color:#ff9f0a">Секундомер</div>
    </div>

    <div id="tab-timer" class="tab">
      <!-- Таймеры -->
      <svg class="icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path fill="#7c7c7c" d="M236.6,271.6c4.6,5.7,11.5,9.4,19.4,9.4c13.8,0,25-11.2,25-25c0-7.3-3.2-13.8-8.2-18.4c-0.6-0.7-1.3-1.5-2.2-2.2
      c0,0-117.7-87.5-120.3-85.2c-2.6,2.3,85.3,120.2,85.3,120.2C235.8,270.8,236.3,271.2,236.6,271.6z"/>
       <path fill="#7c7c7c" d="M256.2,48L256.2,48H256v112h16V65.3c97.8,8.3,175.3,90.5,175.3,190.5c0,105.5-85.7,191.4-191.2,191.4
      c-105.5,0-191.3-85.8-191.3-191.3c0-52.8,21.5-100.6,56.1-135.2L109,108.9C71.3,146.6,48,198.6,48,256c0,114.9,93.1,208,208,208
      c114.9,0,208-93.1,208-208C464,141.1,371,48,256.2,48z"/>
      </svg>
      <div class="label" style="color:#7c7c7c">Таймеры</div>
    </div>
  </nav>

  <script>
    let secretDigits = [];
    let secretIndex = 0;
    let secretMode = false;

    const mmEl = document.getElementById("mm");
    const ssEl = document.getElementById("ss");
    const ccEl = document.getElementById("cc");
    const leftBtn = document.getElementById("leftBtn");
    const rightBtn = document.getElementById("rightBtn");
    const lapsBox = document.getElementById("laps");
    const worldTab = document.getElementById("tab-world");
    const worldIcon = document.getElementById("icon-world");
    const timerTab = document.getElementById("tab-timer");

    let running = false;
    let startTs = 0;
    let elapsed = 0;
    let rafId = null;
    let lapCount = 0;

    function fmt2(n){ return n<10 ? "0"+n : ""+n; }

    function render(ms){
      const total = Math.max(0, ms|0);
      const minutes = Math.floor(total / 60000);
      const seconds = Math.floor((total % 60000) / 1000);
      const centis  = Math.floor((total % 1000) / 10);

      mmEl.textContent = fmt2(minutes);
      ssEl.textContent = fmt2(seconds);
      ccEl.textContent = fmt2(centis);

      if(lapCount>0){
        const lastRow = lapsBox.firstChild;
        if(lastRow){
          lastRow.querySelector(".time-val").textContent = `${fmt2(minutes)}:${fmt2(seconds)},${fmt2(centis)}`;
        }
      }
    }
    render(0);

    function tick(){
      const now = performance.now();
      const ms = elapsed + (now - startTs);
      render(ms);
      rafId = requestAnimationFrame(tick);
    }

    function start(){
      if(running) return;
      running = true;
      startTs = performance.now();
      rightBtn.textContent = "Стоп";
      rightBtn.className = "btn red";
      leftBtn.textContent = "Круг";
      leftBtn.className = "btn circle-active";
      lapsBox.classList.remove("empty");

      if(lapCount === 0){
        lapCount = 1;
        const row = document.createElement("div");
        row.className = "lap-row";
        row.innerHTML = `<div>Круг ${lapCount}</div><div class="time-val">00:00,00</div>`;
        lapsBox.prepend(row);
      }

      if(!rafId) rafId = requestAnimationFrame(tick);
    }

    function stop(){
      if(!running) return;
      running = false;
      cancelAnimationFrame(rafId); rafId = null;
      const now = performance.now();
      elapsed += now - startTs;

      if(secretMode && secretDigits.length){
        const total = Math.max(0, elapsed|0);
        const minutes = Math.floor(total / 60000);
        const seconds = Math.floor((total % 60000) / 1000);
        const forced = secretDigits[secretIndex % secretDigits.length];
        secretIndex++;
        mmEl.textContent = fmt2(minutes);
        ssEl.textContent = fmt2(seconds);
        ccEl.textContent = forced;
      }else{
        render(elapsed);
      }

      rightBtn.textContent = "Старт";
      rightBtn.className = "btn green";
      leftBtn.textContent = "Сброс";
      leftBtn.className = "btn reset";
    }

    function resetAll(){
      running = false;
      cancelAnimationFrame(rafId); rafId = null;
      startTs = 0; elapsed = 0; lapCount = 0;
      lapsBox.innerHTML = "";
      lapsBox.classList.add("empty");
      rightBtn.textContent = "Старт";
      rightBtn.className = "btn green";
      leftBtn.textContent = "Круг";
      leftBtn.className = "btn circle";
      render(0);
    }

    function addLap(){
      if(!running) return;
      lapCount++;
      const now = performance.now();
      const ms = elapsed + (now - startTs);
      const minutes = Math.floor(ms / 60000);
      const seconds = Math.floor((ms % 60000) / 1000);
      const centis  = Math.floor((ms % 1000) / 10);
      const row = document.createElement("div");
      row.className = "lap-row";
      row.innerHTML = `<div>Круг ${lapCount}</div><div class="time-val">${fmt2(minutes)}:${fmt2(seconds)},${fmt2(centis)}</div>`;
      lapsBox.prepend(row);
    }

    rightBtn.addEventListener("click", ()=> running ? stop() : start());
    leftBtn.addEventListener("click", ()=> running ? addLap() : resetAll());

    worldTab.addEventListener("click", ()=>{
      secretMode = !secretMode;
      worldIcon.classList.toggle("rotate", secretMode);
    });

    timerTab.addEventListener("click", ()=>{
      const raw = window.prompt("Введите секретную последовательность (например 123456)", "") || "";
      const digits = raw.replace(/\D/g,"");
      secretDigits = [];
      secretIndex = 0;
      if(digits.length >= 2){
        const even = digits.length % 2 === 0 ? digits : (digits + "0");
        for(let i=0;i<even.length;i+=2){
          secretDigits.push(even.slice(i, i+2));
        }
      }
    });

    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("./sw.js").catch(()=>{});
    }
  </script>
</body>
</html>

